<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Sprint Sport - Premium</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Main CSS -->
  <link rel="stylesheet" href="/style.css">
</head>

<body>

  <!-- Header -->
  <%- include('partials/header') %>

    <!-- Dark Hero Section -->
    <section class="hero-section">
      <div class="hero-overlay"></div>
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-6 hero-content">
            <h1>Next Gen <br> <span>Performance</span></h1>
            <p>Champions keep playing until they get it right. <br> It’s not whether you get knocked down, <br> it’s
              whether you get up.</p>
            <a href="#products" class="neon-btn">Shop Collection</a>
          </div>
          <div class="col-lg-6 text-center d-none d-lg-block position-relative" style="z-index: 2;">
            <!-- Replacing with specific sporty image -->
            <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=2070&auto=format&fit=crop"
              class="img-fluid"
              style="transform: rotate(-15deg); filter: drop-shadow(0 20px 30px rgba(0,0,0,0.5)); max-height: 500px;"
              alt="Hero Shoe">
          </div>
        </div>
      </div>
    </section>

    <!-- Product Grid -->
    <section class="section_gap" id="products" style="padding: 80px 0;">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-6 text-center">
            <div class="section-title mb-5">
              <h1>Latest Drops</h1>
              <p>Exclusive gear available now.</p>
            </div>
          </div>
        </div>
        <div class="row">
          <% products.forEach(product=> { %>
            <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
              <div class="product-card">
                <a href="/product/<%= product.product_id %>">
                  <img src="<%= product.img_url %>" alt="<%= product.product_name %>">
                </a>
                <div class="product-info">
                  <h5>
                    <%= product.product_name %>
                  </h5>
                  <span class="price">Rs <%= product.price %></span>
                  <div class="card-actions">
                    <button class="card-btn add-to-cart-btn" data-product-id="<%= product.product_id %>">
                      <i class="fas fa-shopping-cart"></i> Add
                    </button>
                    <!-- Buy Now logic preserved/added from target app or consistent with source -->
                    <button class="card-btn buy-now-btn" data-product-id="<%= product.product_id %>" style="flex:1;">
                      <i class="fas fa-bolt"></i> Buy Now
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <% }) %>
        </div>
      </div>
    </section>

    <!-- Dark Footer -->
    <%- include('partials/footer') %>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {

          const addToCart = (id, btn, isBuyNow = false) => {
            const originalContent = btn.innerHTML;
            btn.innerHTML = isBuyNow ? 'Processing...' : 'Adding...';
            btn.disabled = true;

            fetch(`/addtocart/${id}`, { method: 'POST', headers: { 'Content-Type': 'application/json' } })
              .then(res => {
                if (res.status === 401) {
                  // Show Login Modal
                  const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                  loginModal.show();
                  throw new Error('Login required'); // Stop further processing
                }
                if (!res.ok) {
                  throw new Error('Network response was not ok');
                }
                return res.json();
              })
              .then(data => {
                if (data.success) {
                  if (isBuyNow) {
                    window.location.href = '/cart';
                    return;
                  }
                  btn.innerHTML = '<i class="fas fa-check"></i> Added';
                  // Update badge
                  if (data.cartCount) {
                    const badge = document.getElementById('cart-badge');
                    if (badge) {
                      badge.textContent = data.cartCount;
                      badge.classList.remove('d-none');
                    }
                  }

                  setTimeout(() => {
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                  }, 2000);

                } else {
                  alert(data.message);
                  btn.innerHTML = originalContent;
                  btn.disabled = false;
                }
              })
              .catch(err => {
                console.error(err);
                if (err.message !== 'Login required') {
                  alert("Something went wrong. Please try again.");
                }
                btn.innerHTML = originalContent;
                btn.disabled = false;
              });
          };

          // Add to Cart Logic
          document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
            btn.addEventListener('click', function (e) {
              e.preventDefault();
              addToCart(this.dataset.productId, this);
            });
          });

          // Buy Now Logic
          document.querySelectorAll('.buy-now-btn').forEach(btn => {
            btn.addEventListener('click', function (e) {
              e.preventDefault();
              const pid = this.dataset.productId;
              window.location.href = `/checkout?productId=${pid}`;
            });
          });

        });
      </script>
</body>

</html>